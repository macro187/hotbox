#!/usr/bin/env sh
set -eu
HOTBOX=$(CDPATH= cd -- "$(dirname -- "$0")" && pwd -P)


. $HOTBOX/lib/sh.sh


HOTBOX_SPEC=""

if [ $# -gt 0 ] ; then
    HOTBOX_SPEC="$1" ; shift
fi

if [ $# -gt 0 ] ; then
    HOTBOX_NAME="$1" ; shift
fi

test $# -eq 0 || die "Unexpected argument '$1'"


HOTBOX_SPEC="${HOTBOX_SPEC:-alpine}"
HOTBOX_NAME="${HOTBOX_NAME:-$HOTBOX_SPEC}"
HOTBOX_IMAGE="hotbox-$HOTBOX_SPEC"
image_id="$(docker image ls -q $HOTBOX_IMAGE)"


if [ -z "$image_id" ] ; then
    $HOTBOX/hotbox-build $HOTBOX_SPEC
fi


$HOTBOX/hotbox-run $HOTBOX_SPEC $HOTBOX_NAME
